<?php
declare (strict_types=1);

namespace app\common\controllers;

use mowzs\lib\Controller;
use think\App;
use yzh52521\Jwt\Util\JWTUtil;

class BaseApi extends Controller
{
    protected int $uid;


    public function __construct(App $app)
    {

        parent::__construct($app);

    }

    protected function initialize(): void
    {
        $this->app->event->trigger('ApiControllerInit');
        try {
            $claims = JWTUtil::getParserData($this->request);
            $this->uid = $claims['id'];
            if (!$this->uid) {
                $this->json([], 401, '请登录！');
            }
        } catch (\Exception $e) {
            $this->json([], 401, '未授权');
        }
        parent::initialize(); // TODO: Change the autogenerated stub

    }

}
